<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pinterest Clone</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bg: #000000; --text: #ffffff; --gray: #262626; --accent: #e60023; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        body { background: var(--bg); color: var(--text); -webkit-tap-highlight-color: transparent; overflow-x: hidden; }

        #auth-page { position: fixed; inset: 0; z-index: 10000; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: flex-end; padding-bottom: 50px; }
        .bg-collage { position: absolute; top: 0; width: 100%; height: 60%; display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 10px; opacity: 0.6; filter: blur(1px); }
        .bg-collage img { width: 100%; height: 150px; object-fit: cover; border-radius: 15px; }
        .auth-content { position: relative; width: 100%; padding: 0 30px; text-align: center; }
        .auth-content h1 { font-size: 28px; margin-bottom: 30px; }
        .auth-input { width: 100%; background: #1a1a1a; color: #fff; border: 1px solid #333; padding: 15px 20px; border-radius: 30px; margin-bottom: 10px; font-size: 16px; outline: none; }
        .btn-red { width: 100%; background: var(--accent); color: white; border: none; padding: 15px; border-radius: 30px; font-weight: bold; font-size: 16px; margin-bottom: 10px; cursor: pointer; }
        .btn-google { width: 100%; background: #fff; color: #000; border: none; padding: 12px; border-radius: 30px; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 10px; cursor: pointer; }
        .btn-google img { width: 22px; height: 22px; border-radius: 50%; object-fit: cover; }

        .navbar { position: fixed; bottom: 0; width: 100%; background: rgba(0,0,0,0.95); display: flex; justify-content: space-around; padding: 10px 0 25px; z-index: 999; }
        .nav-item { color: #8e8e8e; font-size: 10px; display: flex; flex-direction: column; align-items: center; gap: 5px; cursor: pointer; flex: 1; }
        .nav-item i { font-size: 22px; }
        .nav-item.active { color: #fff; }

        .page { display: none; padding-bottom: 80px; }
        .page.active { display: block; }
        
        .header-search { position: sticky; top: 0; background: #000; padding: 10px 15px; z-index: 100; display: flex; align-items: center; gap: 10px; }
        .search-bar { flex: 1; background: var(--gray); border-radius: 25px; padding: 10px 15px; display: flex; align-items: center; gap: 10px; }
        .search-bar input { background: transparent; border: none; color: #fff; flex: 1; outline: none; }

        .pin-container { column-count: 2; column-gap: 10px; padding: 10px; }
        .card { break-inside: avoid; margin-bottom: 10px; border-radius: 15px; overflow: hidden; background: #1a1a1a; }
        .card img { width: 100%; display: block; }

        .profile-tabs { display: flex; justify-content: center; gap: 30px; padding: 15px 0; border-bottom: 1px solid #222; }
        .tab-item { font-weight: bold; color: #8e8e8e; position: relative; padding-bottom: 5px; cursor: pointer; }
        .tab-item.active { color: #fff; }
        .tab-item.active::after { content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 3px; background: #fff; border-radius: 2px; }

        #photo-detail { position: fixed; inset: 0; background: #000; z-index: 2000; display: none; flex-direction: column; overflow-y: auto; }
        .action-top { padding: 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background: #000; }
        .btn-save-round { background: var(--accent); color: white; padding: 10px 25px; border-radius: 25px; border: none; font-weight: bold; }
        .comment-item { display: flex; gap: 10px; margin-bottom: 10px; font-size: 14px; }
    </style>
</head>
<body>

    <div id="auth-page">
        <div class="bg-collage">
            <img src="https://images.unsplash.com/photo-1518791841217-8f162f1e1131?w=200">
            <img src="https://images.unsplash.com/photo-1526336024174-e58f5cdd8e13?w=200">
            <img src="https://images.unsplash.com/photo-1516724562728-afc824a36e84?w=200">
        </div>
        <div class="auth-content">
            <i class="fab fa-pinterest" style="color:var(--accent); font-size:60px; margin-bottom:20px;"></i>
            <h1>Ciptakan kehidupan yang Anda sukai</h1>
            <input type="email" id="email-auth" class="auth-input" placeholder="Alamat email">
            <input type="password" id="pass-auth" class="auth-input" placeholder="Kata sandi">
            <button class="btn-red" id="btn-login-manual">Lanjutkan</button>
            <button class="btn-google" id="btn-google-auth">
                <img src="https://ik.imagekit.io/Kenzo/IMG_20251226_162306.jpg?updatedAt=1766741300056" alt="G"> 
                Lanjutkan dengan Google
            </button>
        </div>
    </div>

    <div id="photo-detail">
        <div class="action-top">
            <i class="fa fa-chevron-left" onclick="closeDetail()" style="font-size:20px; cursor:pointer;"></i>
            <button class="btn-save-round" onclick="saveToProfile()">Simpan</button>
        </div>
        <img id="detail-img" src="" style="width:100%;">
        <div style="padding:20px;">
            <div style="display:flex; align-items:center; gap:10px; margin-bottom:20px;">
                <div id="pfp-mini" style="width:35px; height:35px; border-radius:50%; background-color: #00d084; background-size:cover; display:flex; align-items:center; justify-content:center; font-weight:bold;">U</div>
                <strong id="name-mini">User</strong>
                <button style="margin-left:auto; background:var(--gray); border:none; color:white; padding:8px 15px; border-radius:20px; font-weight:bold;">Ikuti</button>
            </div>
            <h4>Komentar</h4>
            <div id="comments-list" style="margin: 15px 0;"></div>
            <div style="display:flex; gap:10px;">
                <input type="text" id="comment-input" placeholder="Tambahkan komentar" style="flex:1; background:var(--gray); border:none; padding:12px 20px; border-radius:25px; color:white; outline:none;">
                <button onclick="addComment()" style="background:none; border:none; color:var(--accent); font-weight:bold;">Kirim</button>
            </div>
        </div>
    </div>

    <div id="main-app" style="display:none;">
        <div id="page-beranda" class="page active">
            <header class="header-search">
                <div class="search-bar">
                    <i class="fa fa-search"></i>
                    <input type="text" id="search-beranda" placeholder="Cari ide..." onkeypress="handleSearch(event)">
                </div>
            </header>
            <div class="pin-container" id="grid-home"></div>
        </div>

        <div id="page-cari" class="page">
            <div style="padding:15px; font-weight:bold; font-size:20px;">Ide untuk Anda</div>
            <div class="pin-container" id="grid-cari"></div>
        </div>

        <div id="page-profil" class="page">
            <div style="text-align:center; padding:30px 0;">
                <label for="pfp-upload">
                    <div id="u-pfp-main" style="width:100px; height:100px; border-radius:50%; background:#00d084; margin:0 auto; display:flex; align-items:center; justify-content:center; font-size:40px; font-weight:bold; background-size:cover; cursor:pointer;">U</div>
                </label>
                <input type="file" id="pfp-upload" hidden accept="image/*" onchange="changeProfilePic(this)">
                <h2 id="u-name-main" style="margin-top:15px;">User Name</h2>
                <button onclick="logout()" style="background:none; border:none; color:gray; font-size:12px; margin-top:5px; cursor:pointer;">Keluar dari Akun</button>
            </div>
            <div class="profile-tabs">
                <div class="tab-item active">Pin</div>
                <div class="tab-item">Disimpan</div>
            </div>
            <div class="pin-container" id="my-pins"></div>
        </div>

        <nav class="navbar">
            <div class="nav-item active" onclick="navTo('page-beranda', this)"><i class="fa fa-home"></i><span>Beranda</span></div>
            <div class="nav-item" onclick="navTo('page-cari', this)"><i class="fa fa-search"></i><span>Cari</span></div>
            <div class="nav-item" onclick="navTo('page-profil', this)"><i class="fa fa-user-circle"></i><span>Profil</span></div>
        </nav>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDwKskc4ZzZqjGmSKZHbLTrAKY38VWh6L4",
            authDomain: "pinterest-clone-7c535.firebaseapp.com",
            projectId: "pinterest-clone-7c535",
            storageBucket: "pinterest-clone-7c535.firebasestorage.app",
            messagingSenderId: "490245029712",
            appId: "1:490245029712:web:8a5aa487d54dcd20b8f655"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        document.getElementById('btn-login-manual').onclick = () => {
            const email = document.getElementById('email-auth').value;
            const pass = document.getElementById('pass-auth').value;
            signInWithEmailAndPassword(auth, email, pass).catch(e => alert("Error: " + e.message));
        };

        document.getElementById('btn-google-auth').onclick = () => {
            signInWithPopup(auth, provider).catch(e => alert(e.message));
        };

        window.logout = () => signOut(auth);

        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('auth-page').style.display = 'none';
                document.getElementById('main-app').style.display = 'block';
                window.currentUser = user;
                updateUserProfileUI(user);
            } else {
                document.getElementById('auth-page').style.display = 'flex';
                document.getElementById('main-app').style.display = 'none';
            }
        });
    </script>

    <script>
        let selectedImg = "";

        function updateUserProfileUI(user) {
            const name = user.displayName || user.email.split('@')[0];
            document.getElementById('u-name-main').innerText = name;
            document.getElementById('name-mini').innerText = name;
            const pfp = localStorage.getItem('pfp') || user.photoURL;
            if(pfp) {
                document.getElementById('u-pfp-main').style.backgroundImage = `url('${pfp}')`;
                document.getElementById('u-pfp-main').innerText = "";
                document.getElementById('pfp-mini').style.backgroundImage = `url('${pfp}')`;
                document.getElementById('pfp-mini').innerText = "";
            } else {
                document.getElementById('u-pfp-main').innerText = name[0].toUpperCase();
            }
        }

        function navTo(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            if(id === 'page-beranda') fetchImages('aesthetic', 'grid-home');
            if(id === 'page-cari') fetchImages('nature', 'grid-cari');
        }

        async function fetchImages(query, targetId) {
            const grid = document.getElementById(targetId);
            grid.innerHTML = "<p style='padding:20px'>Memuat...</p>";
            try {
                const res = await fetch(`https://api.unsplash.com/photos/random?count=20&query=${query}&client_id=lzV4x5Ho_PmAkk4C6Ec6PuDyFrouDZFaTWVXRVBBb0k`);
                const data = await res.json();
                grid.innerHTML = "";
                data.forEach(img => {
                    const div = document.createElement('div');
                    div.className = 'card';
                    div.onclick = () => openDetail(img.urls.regular);
                    div.innerHTML = `<img src="${img.urls.small}">`;
                    grid.appendChild(div);
                });
            } catch(e) { grid.innerHTML = "Gagal memuat gambar."; }
        }

        function handleSearch(event) {
            if(event.key === "Enter") {
                fetchImages(event.target.value, 'grid-home');
            }
        }

        function openDetail(src) {
            selectedImg = src;
            document.getElementById('photo-detail').style.display = 'flex';
            document.getElementById('detail-img').src = src;
        }

        function closeDetail() { document.getElementById('photo-detail').style.display = 'none'; }

        function saveToProfile() {
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `<img src="${selectedImg}">`;
            document.getElementById('my-pins').prepend(div);
            alert("Berhasil disimpan!");
            closeDetail();
        }

        function addComment() {
            const input = document.getElementById('comment-input');
            if(input.value.trim() !== "") {
                const list = document.getElementById('comments-list');
                const name = window.currentUser.displayName || "User";
                list.innerHTML += `<div class="comment-item"><strong>${name}</strong>: ${input.value}</div>`;
                input.value = "";
            }
        }

        function changeProfilePic(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const url = `url('${e.target.result}')`;
                    document.getElementById('u-pfp-main').style.backgroundImage = url;
                    document.getElementById('u-pfp-main').innerText = "";
                    document.getElementById('pfp-mini').style.backgroundImage = url;
                    localStorage.setItem('pfp', e.target.result);
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        fetchImages('aesthetic', 'grid-home');
    </script>
</body>
</html>
